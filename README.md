# KFイベント領収書管理システム

Node.jsで動作する領収書管理ウェブアプリケーション。複数イベント・チームごとに予算管理、領収書写真アップロード、Slack投稿機能を搭載。ロリポップサーバーでの動作に最適化されています。

## ✨ 新機能: 用途カテゴリ管理

### 📋 機能概要

- **カテゴリ別グループ分け**: 領収書と予定用途を色分けされたカテゴリで管理
- **視覚的な表示**: 各カテゴリに色が設定され、見分けやすい表示
- **集計機能**: カテゴリごとの使用額・予定額の集計表示
- **自由記述保持**: 従来の用途自由記述欄も引き続き利用可能

### 🎨 基本カテゴリ

1. **🍽️ 食材・飲料** - 食材、飲み物、お菓子など
2. **🎨 装飾・展示** - 装飾用品、展示物、看板など  
3. **🔧 設備・機材** - 音響機材、照明、テント、机椅子など
4. **👗 衣装・道具** - 衣装、小道具、メイク用品など
5. **📄 印刷物** - ポスター、チラシ、パンフレット、プログラムなど
6. **🚗 交通費** - 電車代、バス代、タクシー代、ガソリン代など
7. **📦 その他** - 上記に当てはまらないもの

## 🚀 セットアップ手順

### 1. データベースの更新

以下のSQLファイルを順番に実行してください：

```bash
# 1. 用途カラムの追加（未実行の場合）
mysql -u username -p database_name < add_purpose_column.sql

# 2. 用途カテゴリ機能の追加
mysql -u username -p database_name < create_purpose_categories.sql
```

### 2. ファイルのアップロード

新規作成されたファイル：
- `purpose_categories.php` - カテゴリ管理画面
- `create_purpose_categories.sql` - データベース拡張SQL
- `PURPOSE_CATEGORIES_IMPLEMENTATION.md` - 実装手順ドキュメント

更新されたファイル：
- `team.php` - カテゴリ選択機能とグループ表示を追加
- `index.php` - カテゴリ管理画面へのリンクを追加

## 📱 使用方法

### カテゴリ管理
1. トップページから「🏷️ 用途カテゴリ管理」をクリック
2. カテゴリの追加・編集・削除が可能
3. カテゴリごとに色とソート順を設定可能

### 領収書登録
1. チーム画面で新規領収書を追加
2. カテゴリを選択（任意）
3. 用途詳細を入力（従来通り）
4. カテゴリと用途詳細の両方が記録される

### グループ表示
- チーム画面でカテゴリ別集計が自動表示
- 各カテゴリの使用額・予定額・件数を確認可能
- 色分けされた視覚的にわかりやすい表示

## 🔧 システム要件

- PHP 8.0以上
- MySQL 8.0以上
- ロリポップサーバー対応

## 📁 ディレクトリ構造

```
領収書/
├── index.php                          # メイン画面
├── event.php                          # イベント詳細
├── team.php                          # チーム詳細（カテゴリ機能搭載）
├── purpose_categories.php            # カテゴリ管理画面
├── budget_overview.php               # 予算概要
├── config/
│   └── db_connect.php                # データベース接続
├── assets/
│   ├── style.css                     # スタイルシート
│   └── uploads/                      # 領収書画像
├── add_purpose_column.sql            # 用途カラム追加SQL
├── create_purpose_categories.sql     # カテゴリ機能SQL
└── PURPOSE_CATEGORIES_IMPLEMENTATION.md
```

## 📊 データベース構造

### 新規テーブル
- `purpose_categories` - 用途カテゴリマスター

### 更新テーブル
- `receipts` - `purpose_category_id`カラム追加
- `planned_expenses` - `purpose_category_id`カラム追加

## 💡 カテゴリの活用方法

1. **予算計画**: カテゴリごとに予算配分を決定
2. **進捗管理**: カテゴリ別の使用状況を確認
3. **分析**: イベント終了後のカテゴリ別分析
4. **次回計画**: 過去データを基にした次回予算計画

## 🆕 今後の拡張予定

- カテゴリ別予算制限機能
- カテゴリ別レポート出力
- Slack通知のカテゴリ情報含有
- カテゴリ別承認フロー